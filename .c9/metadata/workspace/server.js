{"changed":true,"filter":false,"title":"server.js","tooltip":"/server.js","value":"var express = require('express');\nvar MongoClient = require('mongodb').MongoClient;\nvar assert = require('assert');\nvar ObjectId = require('mongodb').ObjectID;\nvar url = \"mongodb://\" + process.env.IP + \"/patient\";\nvar user_url = \"mongodb://\"+process.env.IP+\"/users\";\nvar app = express();\nvar port = process.env.PORT;\nvar bodyParser = require('body-parser');\nvar reqBody;\nvar patient_phone, user_name, user_pswd;\nvar res_doc;\napp.use(bodyParser.urlencoded({\n    extended: false\n}))\n\nfunction convertJSONForDB(reqBody) {\n    var b = JSON.stringify(reqBody).replace(/'/g, '\"');\n    return JSON.parse(b);\n}\n\nfunction insertData(data) {\n    MongoClient.connect(url, function(err, db, callback) {\n        assert.equal(null, err);\n        db.collection('patient').insertOne(data);\n        db.close();\n\n    });\n}\n\nvar findPatient = function(db, callback) {\n    patient_phone = JSON.parse(patient_phone);\n    db.collection('patient').find(patient_phone).toArray(function(err, results) {\n        assert.equal(err, null);\n        console.log(results);\n        res_doc= results;\n    })\n};\n\nvar findUser = function(db, callback) {\n    user_name = JSON.parse(user_name);\n    user_pswd = JSON.parse(user_pswd);\n    db.collection('users').find(user_name, user_pswd).toArray(function(err, results) {\n        if(err){\n            res_doc=\"\";\n        }else if(results){\n        console.log(results);\n        res_doc= results;\n        }\n        else{\n            res_doc=null;\n        }\n        \n    })\n};\n\napp.get('/', (req, res) => {\n    console.log(\"Basic Get\");\n    res.sendFile(__dirname + '/index.html')\n});\n\napp.post('/patient', function(req, res) {\n    reqBody = req.body;\n    res.sendStatus(200);\n    insertData(convertJSONForDB(reqBody));\n})\n\napp.get('/patient/:phone', function(req, res) {\n    console.log(\"Parameterized Get request\");\n    patient_phone = \"{\\\"phone\\\":\\\"\" + req.params.phone + \"\\\"}\";\n    MongoClient.connect(url, function(err, db) {\n        assert.equal(null, err);\n        findPatient(db, function() {\n            db.close();\n        });\n    });\n    res.send(res_doc);\n    res_doc=\"\";\n});\n\n\n//App Related functions \n\napp.get('user/:user_name/:password', function(req, res) {\n   console.log(\"App Login Initiated..\");\n   user_name= \"{\\\"user_name\\\":\\\"\" + req.params.user_name+\"\\\"}\";\n   user_pswd= \"{\\\"password\\\":\\\"\" + req.params.password+\"\\\"}\";\n   MongoClient.connect(user_url, function(err, db) {\n        assert.equal(null, err);\n        findUser(db, function() {\n            db.close();\n        });\n    });\n    if(res_doc !=null || res_doc!=\"\"){\n        res.send(401);\n    }\n    res.send(200);\n});\n\napp.listen(port, process.env.IP);\nconsole.log('Listening on port...' + port, process.env.IP);\n","undoManager":{"mark":-400,"position":100,"stack":[[{"start":{"row":86,"column":14},"end":{"row":86,"column":15},"action":"insert","lines":[" "],"id":3655}],[{"start":{"row":86,"column":15},"end":{"row":86,"column":16},"action":"insert","lines":["!"],"id":3656}],[{"start":{"row":86,"column":16},"end":{"row":86,"column":17},"action":"insert","lines":["="],"id":3657}],[{"start":{"row":86,"column":17},"end":{"row":86,"column":18},"action":"insert","lines":["n"],"id":3658}],[{"start":{"row":86,"column":18},"end":{"row":86,"column":19},"action":"insert","lines":["u"],"id":3659}],[{"start":{"row":86,"column":19},"end":{"row":86,"column":20},"action":"insert","lines":["l"],"id":3660}],[{"start":{"row":86,"column":20},"end":{"row":86,"column":21},"action":"insert","lines":["l"],"id":3661}],[{"start":{"row":86,"column":21},"end":{"row":86,"column":22},"action":"insert","lines":[" "],"id":3662}],[{"start":{"row":86,"column":22},"end":{"row":86,"column":23},"action":"insert","lines":["|"],"id":3663}],[{"start":{"row":86,"column":23},"end":{"row":86,"column":24},"action":"insert","lines":["|"],"id":3664}],[{"start":{"row":86,"column":24},"end":{"row":86,"column":25},"action":"insert","lines":[" "],"id":3665}],[{"start":{"row":86,"column":25},"end":{"row":86,"column":26},"action":"insert","lines":["r"],"id":3666}],[{"start":{"row":86,"column":26},"end":{"row":86,"column":27},"action":"insert","lines":["e"],"id":3667}],[{"start":{"row":86,"column":27},"end":{"row":86,"column":28},"action":"insert","lines":["s"],"id":3668}],[{"start":{"row":86,"column":28},"end":{"row":86,"column":29},"action":"insert","lines":["_"],"id":3669}],[{"start":{"row":86,"column":29},"end":{"row":86,"column":30},"action":"insert","lines":["d"],"id":3670}],[{"start":{"row":86,"column":30},"end":{"row":86,"column":31},"action":"insert","lines":["o"],"id":3671}],[{"start":{"row":86,"column":31},"end":{"row":86,"column":32},"action":"insert","lines":["c"],"id":3672}],[{"start":{"row":86,"column":32},"end":{"row":86,"column":33},"action":"insert","lines":["!"],"id":3673}],[{"start":{"row":86,"column":33},"end":{"row":86,"column":34},"action":"insert","lines":["="],"id":3674}],[{"start":{"row":86,"column":34},"end":{"row":86,"column":36},"action":"insert","lines":["\"\""],"id":3675}],[{"start":{"row":86,"column":37},"end":{"row":86,"column":38},"action":"insert","lines":["{"],"id":3676}],[{"start":{"row":86,"column":38},"end":{"row":88,"column":5},"action":"insert","lines":["","        ","    }"],"id":3677}],[{"start":{"row":43,"column":8},"end":{"row":43,"column":32},"action":"remove","lines":["assert.equal(err, null);"],"id":3678},{"start":{"row":43,"column":8},"end":{"row":43,"column":9},"action":"insert","lines":["i"]}],[{"start":{"row":43,"column":9},"end":{"row":43,"column":10},"action":"insert","lines":["f"],"id":3679}],[{"start":{"row":43,"column":10},"end":{"row":43,"column":12},"action":"insert","lines":["()"],"id":3680}],[{"start":{"row":43,"column":11},"end":{"row":43,"column":12},"action":"insert","lines":["e"],"id":3681}],[{"start":{"row":43,"column":12},"end":{"row":43,"column":13},"action":"insert","lines":["r"],"id":3682}],[{"start":{"row":43,"column":13},"end":{"row":43,"column":14},"action":"insert","lines":["r"],"id":3683}],[{"start":{"row":43,"column":15},"end":{"row":43,"column":16},"action":"insert","lines":["{"],"id":3684}],[{"start":{"row":43,"column":16},"end":{"row":45,"column":9},"action":"insert","lines":["","            ","        }"],"id":3685}],[{"start":{"row":44,"column":12},"end":{"row":44,"column":13},"action":"insert","lines":["r"],"id":3686}],[{"start":{"row":44,"column":13},"end":{"row":44,"column":14},"action":"insert","lines":["e"],"id":3687}],[{"start":{"row":44,"column":14},"end":{"row":44,"column":15},"action":"insert","lines":["s"],"id":3688}],[{"start":{"row":44,"column":15},"end":{"row":44,"column":16},"action":"insert","lines":["_"],"id":3689}],[{"start":{"row":44,"column":16},"end":{"row":44,"column":17},"action":"insert","lines":["d"],"id":3690}],[{"start":{"row":44,"column":17},"end":{"row":44,"column":18},"action":"insert","lines":["o"],"id":3691}],[{"start":{"row":44,"column":18},"end":{"row":44,"column":19},"action":"insert","lines":["c"],"id":3692}],[{"start":{"row":44,"column":19},"end":{"row":44,"column":20},"action":"insert","lines":["="],"id":3693}],[{"start":{"row":44,"column":20},"end":{"row":44,"column":22},"action":"insert","lines":["\"\""],"id":3694}],[{"start":{"row":44,"column":22},"end":{"row":44,"column":23},"action":"insert","lines":[";"],"id":3695}],[{"start":{"row":45,"column":9},"end":{"row":45,"column":10},"action":"insert","lines":["e"],"id":3696}],[{"start":{"row":45,"column":10},"end":{"row":45,"column":11},"action":"insert","lines":["l"],"id":3697}],[{"start":{"row":45,"column":11},"end":{"row":45,"column":12},"action":"insert","lines":["s"],"id":3698}],[{"start":{"row":45,"column":12},"end":{"row":45,"column":13},"action":"insert","lines":["e"],"id":3699}],[{"start":{"row":45,"column":13},"end":{"row":45,"column":14},"action":"insert","lines":["{"],"id":3700}],[{"start":{"row":47,"column":25},"end":{"row":48,"column":0},"action":"insert","lines":["",""],"id":3701},{"start":{"row":48,"column":0},"end":{"row":48,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":48,"column":8},"end":{"row":48,"column":9},"action":"insert","lines":["}"],"id":3702}],[{"start":{"row":45,"column":13},"end":{"row":45,"column":14},"action":"insert","lines":[" "],"id":3703}],[{"start":{"row":45,"column":14},"end":{"row":45,"column":15},"action":"insert","lines":["i"],"id":3704}],[{"start":{"row":45,"column":15},"end":{"row":45,"column":16},"action":"insert","lines":["f"],"id":3705}],[{"start":{"row":45,"column":16},"end":{"row":45,"column":17},"action":"insert","lines":["("],"id":3706}],[{"start":{"row":45,"column":17},"end":{"row":45,"column":18},"action":"insert","lines":["r"],"id":3707}],[{"start":{"row":45,"column":18},"end":{"row":45,"column":19},"action":"insert","lines":["e"],"id":3708}],[{"start":{"row":45,"column":19},"end":{"row":45,"column":20},"action":"insert","lines":["s"],"id":3709}],[{"start":{"row":45,"column":20},"end":{"row":45,"column":21},"action":"insert","lines":["u"],"id":3710}],[{"start":{"row":45,"column":21},"end":{"row":45,"column":22},"action":"insert","lines":["l"],"id":3711}],[{"start":{"row":45,"column":22},"end":{"row":45,"column":23},"action":"insert","lines":["t"],"id":3712}],[{"start":{"row":45,"column":23},"end":{"row":45,"column":24},"action":"insert","lines":[")"],"id":3713}],[{"start":{"row":45,"column":24},"end":{"row":45,"column":25},"action":"insert","lines":["s"],"id":3714}],[{"start":{"row":45,"column":24},"end":{"row":45,"column":25},"action":"remove","lines":["s"],"id":3715}],[{"start":{"row":45,"column":23},"end":{"row":45,"column":24},"action":"insert","lines":["s"],"id":3716}],[{"start":{"row":48,"column":9},"end":{"row":49,"column":0},"action":"insert","lines":["",""],"id":3717},{"start":{"row":49,"column":0},"end":{"row":49,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":49,"column":8},"end":{"row":49,"column":9},"action":"insert","lines":["e"],"id":3718}],[{"start":{"row":49,"column":9},"end":{"row":49,"column":10},"action":"insert","lines":["l"],"id":3719}],[{"start":{"row":49,"column":10},"end":{"row":49,"column":11},"action":"insert","lines":["s"],"id":3720}],[{"start":{"row":49,"column":11},"end":{"row":49,"column":12},"action":"insert","lines":["e"],"id":3721}],[{"start":{"row":49,"column":12},"end":{"row":50,"column":0},"action":"insert","lines":["",""],"id":3722},{"start":{"row":50,"column":0},"end":{"row":50,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":49,"column":12},"end":{"row":49,"column":13},"action":"insert","lines":["{"],"id":3723}],[{"start":{"row":49,"column":13},"end":{"row":51,"column":9},"action":"insert","lines":["","            ","        }"],"id":3724}],[{"start":{"row":50,"column":12},"end":{"row":50,"column":13},"action":"insert","lines":["r"],"id":3725}],[{"start":{"row":50,"column":13},"end":{"row":50,"column":14},"action":"insert","lines":["e"],"id":3726}],[{"start":{"row":50,"column":14},"end":{"row":50,"column":15},"action":"insert","lines":["s"],"id":3727}],[{"start":{"row":50,"column":15},"end":{"row":50,"column":16},"action":"insert","lines":["_"],"id":3728}],[{"start":{"row":50,"column":16},"end":{"row":50,"column":17},"action":"insert","lines":["d"],"id":3729}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["o"],"id":3730}],[{"start":{"row":50,"column":18},"end":{"row":50,"column":19},"action":"insert","lines":["c"],"id":3731}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"insert","lines":[" "],"id":3732}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"remove","lines":[" "],"id":3733}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"insert","lines":["="],"id":3734}],[{"start":{"row":50,"column":20},"end":{"row":50,"column":21},"action":"insert","lines":["n"],"id":3735}],[{"start":{"row":50,"column":21},"end":{"row":50,"column":22},"action":"insert","lines":["u"],"id":3736}],[{"start":{"row":50,"column":22},"end":{"row":50,"column":23},"action":"insert","lines":["l"],"id":3737}],[{"start":{"row":50,"column":23},"end":{"row":50,"column":24},"action":"insert","lines":["l"],"id":3738}],[{"start":{"row":50,"column":24},"end":{"row":50,"column":25},"action":"insert","lines":[";"],"id":3739}],[{"start":{"row":94,"column":8},"end":{"row":94,"column":9},"action":"insert","lines":["r"],"id":3740}],[{"start":{"row":94,"column":9},"end":{"row":94,"column":10},"action":"insert","lines":["e"],"id":3741}],[{"start":{"row":94,"column":10},"end":{"row":94,"column":11},"action":"insert","lines":["s"],"id":3742}],[{"start":{"row":94,"column":11},"end":{"row":94,"column":12},"action":"insert","lines":["."],"id":3743}],[{"start":{"row":94,"column":12},"end":{"row":94,"column":13},"action":"insert","lines":["s"],"id":3744}],[{"start":{"row":94,"column":13},"end":{"row":94,"column":14},"action":"insert","lines":["e"],"id":3745}],[{"start":{"row":94,"column":14},"end":{"row":94,"column":15},"action":"insert","lines":["n"],"id":3746}],[{"start":{"row":94,"column":15},"end":{"row":94,"column":16},"action":"insert","lines":["d"],"id":3747}],[{"start":{"row":94,"column":16},"end":{"row":94,"column":18},"action":"insert","lines":["()"],"id":3748}],[{"start":{"row":94,"column":17},"end":{"row":94,"column":18},"action":"insert","lines":["4"],"id":3749}],[{"start":{"row":94,"column":18},"end":{"row":94,"column":19},"action":"insert","lines":["0"],"id":3750}],[{"start":{"row":94,"column":19},"end":{"row":94,"column":20},"action":"insert","lines":["1"],"id":3751}],[{"start":{"row":94,"column":21},"end":{"row":94,"column":22},"action":"insert","lines":[";"],"id":3752}],[{"start":{"row":96,"column":13},"end":{"row":96,"column":20},"action":"remove","lines":["res_doc"],"id":3753},{"start":{"row":96,"column":13},"end":{"row":96,"column":14},"action":"insert","lines":["2"]}],[{"start":{"row":96,"column":14},"end":{"row":96,"column":15},"action":"insert","lines":["0"],"id":3754}],[{"start":{"row":96,"column":15},"end":{"row":96,"column":16},"action":"insert","lines":["0"],"id":3755}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":96,"column":18},"end":{"row":96,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1476759583000}